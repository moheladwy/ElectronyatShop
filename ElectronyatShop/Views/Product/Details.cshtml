@using ElectronyatShop.Data
@using ElectronyatShop.ViewModels
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Authorization
@inject ApplicationDbContext context
@model CartItemViewModel

@{
	ViewData["Title"] = "Product Details";
	Product product = context.Products.Where(p => p.Id == Model.ProductId).FirstOrDefault();
	decimal actualPrice = (product.DiscountPercentage > 0) ?
		(product.Price - (product.DiscountPercentage * product.Price / 100)) : product.Price;
}

<!-- Product section-->
<section class="py-5">
	<div class="container px-4 px-lg-5 my-5">
		<div class="row gx-4 gx-lg-5 align-items-center">
			<div class="col-md-6 img-container">
				<img class="card-img-top mb-5 mb-md-0 product-img" src="~/Images/@product.Image" alt="@product.Name">
			</div>
			<div class="col-md-6">
				<h1 class="product-name display-5">@product.Name</h1>
				<div class="fs-5 mb-5">
					@if (product.DiscountPercentage > 0)
					{
						<span class="text-decoration-line-through">$@product.Price</span>
						<span style="margin: 0 10px;"> - </span>
						<span>@actualPrice</span>
					}
					else
					{
						<span>$@product.Price</span>
					}
				</div>
				<p class="lead">@product.Description</p>
				<div class="fs-5 mb-5">
					@if (product.AvailableQuantity > 0)
					{
						<span>Available: (@product.AvailableQuantity)</span>
					}
					else
					{
						<span style="color: red;">Not available right now</span>
					}
				</div>
				<!-- Shopping Cart -->
				<form method="post" asp-controller="Cart" asp-action="AddToCart">
					<div class="d-flex">
						<input asp-for="ProductId" hidden />
						<input class="input-quantity form-control text-center me-3" asp-for="@Model.Quantity" 
						min="1" max="@product.AvailableQuantity" value="1"/>
						<button class="action btn btn-outline-dark flex-shrink-0 me-3" type="submit">
							<i class="bi-cart-fill me-1"></i>
							Add to cart
						</button>
						<a class="action btn btn-outline-dark flex-shrink-0" asp-controller="Product" asp-action="Index">Back</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</section>

@section Links {
	<link rel="icon" type="image/x-icon" href="~/assets/favicon.ico" />
	<style>
		.product-name {
			font-size: 40px;
			font-weight: 600;
			text-align: left;
		}

		.img-container {
			margin-right: 5px;
			max-width: 425px;
		}

		.product-img {
			max-width: 350px;
			max-height: 400px;
			margin-top: 1em;
		}

		.input-quantity {
			max-width: 4rem;
			border-radius: 1em;
		}

		.action {
			padding: 15px;
			border-radius: 1em;
		}
	</style>
}

@section Scripts {
	<!-- Core theme JS-->
	<script src="~/js/scripts.js"></script>
	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
	<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
}